---
export interface Props {
	title?: string;
	variant?: 'primary' | 'secondary';
	link?: string;
	toggle?: boolean;
}

const { title, variant = 'primary', link, toggle = false } = Astro.props;

const Element = toggle ? 'details' : 'div';
const TitleElement = toggle ? 'summary' : 'div';
---

<div class:list={['card', { secondary: variant === 'secondary' }]}>
	{
		link && (
			<a href={link} class="card-image-link">
				<slot name="img" />
			</a>
		)
	}
	{!link && <slot name="img" />}
	<Element class="details">
		<TitleElement class="title">
			{
				title && link && (
					<h3>
						<a href={link}>{title}</a>
					</h3>
				)
			}
			{title && !link && <h3>{title}</h3>}
			{!title && <slot name="title" />}
		</TitleElement>
		<div class="description">
			<slot />
		</div>
	</Element>
</div>

<style>
	.card {
		--gap: 4px;

		background: var(--bg);
		border: 0.5px solid color-mix(in oklch, var(--gray-600), transparent);
		border-radius: 3px;
		display: flex;
		flex-direction: column;
		gap: var(--gap);

		.details {
			display: flex;
			flex-direction: column;
			gap: var(--gap);
			padding: 16px;
		}

		&.secondary {
			background: unset;
			border: none;

			.details {
				padding-block: 8px;
			}
		}

		&:has(> img, > .card-image-link) {
			gap: 16px;

			img {
				border-block-end: 0.5px solid
					color-mix(in oklch, var(--gray-600), transparent);
				border-radius: 3px 3px 0 0;
				max-inline-size: 100%;
			}

			.card-image-link {
				display: block;
				line-height: 0;

				img {
					display: block;
				}
			}

			.details {
				padding-block-start: 0;
			}
		}

		.title {
			color: var(--text-emphasized);
			font-size: 1em;
			font-weight: 400;
			line-height: 1.25;
			margin: 0;

			&:empty {
				display: none;
			}

			* {
				color: inherit;
				font-size: inherit;
				font-weight: inherit;
				line-height: inherit;
			}

			:is(h1, h2, h3, h4, h5, h6) {
				font-size: clamp(1em, 3.5cqi, 1.125em);
				font-variation-settings: 'wdth' 100;
				font-weight: 500;
				line-height: 1.1;

				summary & {
					display: inline-block;
					margin-inline-start: 4px;
				}
			}

			a {
				color: inherit;
				text-decoration: none;

				&:is(:hover, :active, :hover) {
					text-decoration: underline;
				}
			}
		}

		.description {
			color: var(--text-muted);
			display: flex;
			flex-direction: column;
			font-optical-sizing: auto;
			font-weight: 300;
			gap: var(--gap);
			line-height: 1.35;

			> * {
				color: inherit;
				font-size: inherit;
				line-height: inherit;
				margin: 0;
			}
		}
	}
</style>
