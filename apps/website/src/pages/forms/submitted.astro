---
import { SignedIn, SignedOut, SignIn } from '@clerk/astro/components';
import Layout from '../../layouts/default.astro';
import { actions } from 'astro:actions';

const url = Astro.url;
url.pathname = '/forms/web-dev-challenge';

const result = await Astro.getActionResult(actions.forms.wdc);
console.log({ result });

const user = await Astro.locals.currentUser();

const discordAcct = user?.externalAccounts.find(
	(acct) => acct.provider === 'oauth_discord',
);
---

<Layout title="Web Dev Challenge Filming Questionnaire">
	<main>
		<SignedIn>
			<section class="wrapper">
				<h2>Thanks, {user?.firstName}!</h2>

				<pre>{JSON.stringify({ test: true, result, discordAcct }, null, 2)}</pre>
				<p>
					Your response has been saved. You can update your bio, profile photo,
					and links at any time on <a href="/dashboard">your dashboard</a>.
				</p>
			</section>
		</SignedIn>

		<SignedOut>
			<SignIn forceRedirectUrl={url.toString()} />
		</SignedOut>
	</main>
</Layout>

<style>
	main {
		background: var(--black);
		padding: 40px 5cqw 60px;
	}

	.wrapper {
		margin-inline: auto;
		max-inline-size: 54ch;

		@media (min-width: 750px) {
			padding-block-start: 120px;
		}
	}
</style>
